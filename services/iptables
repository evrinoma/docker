#!/bin/bash

SERVERS=([8070]=172.18.72.4 [8080]=172.18.1.5 [8090]=172.18.1.6 [8100]=172.18.53.12)
#bridge=$(iptables -L -v -n  | grep 1.4 | awk '{print $7}')
bridge=$(brctl show | grep -e "br" | grep -e "veth" | awk {'print $1'})

echo $bridge

for index in ${!SERVERS[*]}
do
    iptables -t nat -A DOCKER ! -i $bridge -p tcp -m tcp --dport $index -j DNAT --to-destination ${SERVERS[$index]}:80
    iptables -t filter -A DOCKER -d ${SERVERS[$index]}/32 ! -i $bridge -o $bridge -p tcp -m tcp --dport 80 -j ACCEPT
done
